# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç RAG —Å–∏—Å—Ç–µ–º—ã
**–î–∞—Ç–∞**: 16.01.2026 05:42  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´

---

## –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏

### 1. Document Ingestion (–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã

**–¢–µ—Å—Ç**:
- –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç `test-architecture.md` (1.2KB)
- –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å–∏—Å—Ç–µ–º—ã
- –ó–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ POST `/ingest`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£–°–ü–ï–•
```
Files processed: 1
Chunks created: 2
Processing time: ~5 seconds
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**: 
- –î–æ–∫—É–º–µ–Ω—Ç —Ä–∞–∑–±–∏—Ç –Ω–∞ 2 —á–∞–Ω–∫–∞ (chunk_size=512, overlap=50)
- –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (source, chunk_index)
- –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ ChromaDB (SQLite: `/chroma/chroma/chroma.sqlite3`)

---

### 2. Vector Storage (–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑–µ

**–¢–µ—Å—Ç**:
- –ó–∞–ø—Ä–æ—Å GET `/inspect`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£–°–ü–ï–•
```json
{
  "total_documents": 2,
  "collection_name": "rag_documents"
}
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**:
- ChromaDB —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ PersistentClient
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: SQLite —Ñ–∞–π–ª –≤ volume
- –ö–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

---

### 3. Semantic Search (–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫)
**–¶–µ–ª—å**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Å–º—ã—Å–ª—É

#### Test 3.1: –ü–æ–∏—Å–∫ –ø–æ "What is Ollama?"
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£–°–ü–ï–•
```
Query: "What is Ollama?"
Found: 2 results
Processing time: 167ms
Top result score: 1.34

Content: "Ollama provides local LLM inference. 
It runs models like llama2 and nomic-embed-text.
The service listens on port 11434..."
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**:
- –°–∏—Å—Ç–µ–º–∞ –Ω–∞—à–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —á–∞–Ω–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º Ollama
- Score 1.34 (–º–µ–Ω—å—à–µ = –ª—É—á—à–µ –≤ ChromaDB distance metric)
- –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Å–µ–º–∞–Ω—Ç–∏–∫–µ, –Ω–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º

#### Test 3.2: –ü–æ–∏—Å–∫ –ø–æ "vector database"
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£–°–ü–ï–•
```
Query: "vector database"
Found: 1 result
Score: 1.46

Content contains: "ChromaDB for vector storage"
Match: True
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**:
- –ù–∞—à—ë–ª —á–∞–Ω–∫ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º ChromaDB
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å: "vector database" ‚Üí "ChromaDB"
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–æ—á–Ω–∞—è —Ñ—Ä–∞–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

#### Test 3.3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ MCP Gateway
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£–°–ü–ï–•
```
Query via MCP Gateway: "ports"
Found: 1 result
Processing time: 196ms

Content: "...service listens on port 11434..."
```

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**:
- MCP Gateway —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ RAG API
- –î–æ–±–∞–≤–ª—è–µ—Ç ~30ms overhead (196ms vs 167ms direct)
- –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Kiro IDE

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)

### Data Flow (–∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç):

```
1. INGEST:
   User ‚Üí POST /ingest ‚Üí RAG API
   ‚Üì
   TextLoader –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª
   ‚Üì
   RecursiveCharacterTextSplitter —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ —á–∞–Ω–∫–∏
   ‚Üì
   ChromaDB.add() —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
   ‚Üì
   –î–∞–Ω–Ω—ã–µ –≤ /chroma/chroma/chroma.sqlite3

2. QUERY:
   User ‚Üí POST /query ‚Üí RAG API
   ‚Üì
   ChromaDB.query() –∏—â–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –≤–µ–∫—Ç–æ—Ä—ã
   ‚Üì
   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç top_k —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å scores
   ‚Üì
   JSON response —Å content + metadata
```

### –ß—Ç–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç):
- ‚ùå Ollama embeddings (ChromaDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ)
- ‚ùå Reranking (–ø–æ–∫–∞ –Ω–µ –Ω—É–∂–µ–Ω)
- ‚ùå Hybrid search (—Ç–æ–ª—å–∫–æ semantic)

**–ü–æ—á–µ–º—É**: –î–ª—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö embeddings ChromaDB.

---

## Performance (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

### –ò–∑–º–µ—Ä–µ–Ω–æ:
- **Ingest**: ~5 —Å–µ–∫—É–Ω–¥ –¥–ª—è 1.2KB —Ñ–∞–π–ª–∞ (–≤–∫–ª—é—á–∞—è chunking)
- **Query**: 167-196ms –¥–ª—è semantic search
- **Storage**: 2 chunks = ~2KB –≤ SQLite

### Bottlenecks (—É–∑–∫–∏–µ –º–µ—Å—Ç–∞):
1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –º–µ–¥–ª–µ–Ω–Ω–µ–µ (cold start)
2. –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è embeddings
3. –ù–µ—Ç batch processing

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
- –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –∫—ç—à–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama embeddings (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ)
- Batch ingest –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

---

## –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 1: UnstructuredMarkdownLoader
**–û—à–∏–±–∫–∞**: `unstructured package not found`

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏–ª–∏ –Ω–∞ TextLoader
```python
# –ë—ã–ª–æ:
loader = UnstructuredMarkdownLoader(file_path)

# –°—Ç–∞–ª–æ:
loader = TextLoader(file_path, encoding='utf-8')
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è .md, .txt, –∏ –¥—Ä—É–≥–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:
1. **Document ingestion** - –∑–∞–≥—Ä—É–∑–∫–∞ –∏ chunking
2. **Vector storage** - ChromaDB PersistentClient
3. **Semantic search** - –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. **MCP Gateway** - proxy —Ä–∞–±–æ—Ç–∞–µ—Ç
5. **Metadata** - source –∏ chunk_index —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

### ‚ö†Ô∏è –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:
1. –î–æ–±–∞–≤–∏—Ç—å Ollama embeddings (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö)
2. –î–æ–±–∞–≤–∏—Ç—å reranking –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
3. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF (PyPDFLoader —É–∂–µ –µ—Å—Ç—å)
5. Batch processing –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:
- **–ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: ‚úÖ –ì–æ—Ç–æ–≤–∞
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: ‚ö†Ô∏è –ù—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: ‚úÖ –ï—Å—Ç—å

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kiro IDE
```json
// .kiro/settings/mcp.json
{
  "mcpServers": {
    "local-rag": {
      "command": "curl",
      "args": ["-X", "POST", "http://localhost:9002/query", 
               "-H", "Content-Type: application/json",
               "-d", "{\"query\": \"$QUERY\", \"top_k\": 5}"],
      "disabled": false
    }
  }
}
```

### 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```powershell
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞
.\scripts\ingest-docs.ps1 -Path "C:\your\project\docs" -Recursive
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å Qwen
```
@kiro 
1. –ò—Å–ø–æ–ª—å–∑—É–π rag_query —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
2. –ò—Å–ø–æ–ª—å–∑—É–π qwen_chat —á—Ç–æ–±—ã –æ–±—ä—è—Å–Ω–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω–æ–µ
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**RAG —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç:
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- ‚úÖ REST API
- ‚úÖ MCP Gateway

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ end-to-end –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ö–æ—Ä–æ—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
